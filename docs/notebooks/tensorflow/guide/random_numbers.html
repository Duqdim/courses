

<!DOCTYPE html>
<html class="writer-html5" lang="es" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Copyright 2019 The TensorFlow Authors. &mdash; documentación de --- Cursos --- - </title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../../_static/clipboard.min.js"></script>
        <script type="text/javascript" src="../../../_static/copybutton.js"></script>
        <script type="text/javascript" src="../../../_static/translations.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Índice" href="../../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> --- Cursos ---
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Configuración</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../setup.html">Instalación de Vagrant y Docker</a></li>
</ul>
<p class="caption"><span class="caption-text">Cursos</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../analitica-de-grandes-datos/index.html">Analítica de grandes datos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../analitica-financiera/index.html">Analítica Financiera</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../analitica-predictiva/index.html">Analítica Predictiva</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ciencia-de-los-datos/index.html">Ciencia de los Datos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fundamentos-de-analitica/index.html">Fundamentos de Analítica</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../productos-de-datos/index.html">Productos de Datos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../redes-neuronales-con-tensorflow/index.html">Redes Neuronales Artificiales</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">--- Cursos ---</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Copyright 2019 The TensorFlow Authors.</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../_sources/notebooks/tensorflow/guide/random_numbers.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Copyright-2019-The-TensorFlow-Authors.">
<h1>Copyright 2019 The TensorFlow Authors.<a class="headerlink" href="#Copyright-2019-The-TensorFlow-Authors." title="Enlazar permanentemente con este título">¶</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>#@title Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
</pre></div>
</div>
</div>
<div class="section" id="Random-number-generation">
<h2>Random number generation<a class="headerlink" href="#Random-number-generation" title="Enlazar permanentemente con este título">¶</a></h2>
<table class="tfo-notebook-buttons" align="left"><td><p><a href="#id1"><span class="problematic" id="id2">|</span></a>95efee4647fe4fdd871c972423f48e76|View on TensorFlow.org</p>
</td><td><p><a href="#id3"><span class="problematic" id="id4">|</span></a>f715573eee1a4ae1b06eb3dcbef4507a|Run in Google Colab</p>
</td><td><p><a href="#id5"><span class="problematic" id="id6">|</span></a>9f426829422244349f07091277240529|View source on GitHub</p>
</td><td><p><a href="#id7"><span class="problematic" id="id8">|</span></a>fddc9e02e3694bdf9ab868a5598b7c3d|Download notebook</p>
</td></table><p>TensorFlow provides a set of pseudo-random number generators (RNG), in the <code class="docutils literal notranslate"><span class="pre">tf.random</span></code> module. This document describes how you can control the random number generators, and how these generators interact with other tensorflow sub-systems.</p>
<p>TensorFlow provides two approaches for controlling the random number generation process:</p>
<ol class="arabic simple">
<li><p>Through the explicit use of <code class="docutils literal notranslate"><span class="pre">tf.random.Generator</span></code> objects. Each such object maintains a state (in <code class="docutils literal notranslate"><span class="pre">tf.Variable</span></code>) that will be changed after each number generation.</p></li>
<li><p>Through the purely-functional stateless random functions like <code class="docutils literal notranslate"><span class="pre">tf.random.stateless_uniform</span></code>. Calling these functions with the same arguments (which include the seed) and on the same device will always produce the same results.</p></li>
</ol>
<p>Warning: The old RNGs from TF 1.x such as <code class="docutils literal notranslate"><span class="pre">tf.random.uniform</span></code> and <code class="docutils literal notranslate"><span class="pre">tf.random.normal</span></code> are not yet deprecated but strongly discouraged.</p>
<p>Warning: The random numbers are not guaranteed to be consistent across TensorFlow versions, see: <a class="reference external" href="https://www.tensorflow.org/guide/versions#what_is_not_covered">Version Compatibility</a></p>
<div class="section" id="Setup">
<h3>Setup<a class="headerlink" href="#Setup" title="Enlazar permanentemente con este título">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>import tensorflow as tf

# Creates 2 virtual devices cpu:0 and cpu:1 for using distribution strategy
physical_devices = tf.config.list_physical_devices(&quot;CPU&quot;)
tf.config.experimental.set_virtual_device_configuration(
    physical_devices[0], [
        tf.config.experimental.VirtualDeviceConfiguration(),
        tf.config.experimental.VirtualDeviceConfiguration()
    ])
</pre></div>
</div>
</div>
</div>
<div class="section" id="The-tf.random.Generator-class">
<h3>The <code class="docutils literal notranslate"><span class="pre">tf.random.Generator</span></code> class<a class="headerlink" href="#The-tf.random.Generator-class" title="Enlazar permanentemente con este título">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">tf.random.Generator</span></code> class is used in cases where you want each RNG call to produce different results. It maintains an internal state (managed by a <code class="docutils literal notranslate"><span class="pre">tf.Variable</span></code> object) which will be updated every time random numbers are generated. Because the state is managed by <code class="docutils literal notranslate"><span class="pre">tf.Variable</span></code>, it enjoys all facilities provided by <code class="docutils literal notranslate"><span class="pre">tf.Variable</span></code> such as easy checkpointing, automatic control-dependency and thread safety.</p>
<p>You can get a <code class="docutils literal notranslate"><span class="pre">tf.random.Generator</span></code> by manually creating an object of the class or call <code class="docutils literal notranslate"><span class="pre">tf.random.get_global_generator()</span></code> to get the default global generator:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>g1 = tf.random.Generator.from_seed(1)
print(g1.normal(shape=[2, 3]))
g2 = tf.random.get_global_generator()
print(g2.normal(shape=[2, 3]))
</pre></div>
</div>
</div>
<p>There are multiple ways to create a generator object. The easiest is <code class="docutils literal notranslate"><span class="pre">Generator.from_seed</span></code>, as shown above, that creates a generator from a seed. A seed is any non-negative integer. <code class="docutils literal notranslate"><span class="pre">from_seed</span></code> also takes an optional argument <code class="docutils literal notranslate"><span class="pre">alg</span></code> which is the RNG algorithm that will be used by this generator:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>g1 = tf.random.Generator.from_seed(1, alg=&#39;philox&#39;)
print(g1.normal(shape=[2, 3]))
</pre></div>
</div>
</div>
<p>See the <em>Algorithms</em> section below for more information about it.</p>
<p>Another way to create a generator is with <code class="docutils literal notranslate"><span class="pre">Generator.from_non_deterministic_state</span></code>. A generator created this way will start from a non-deterministic state, depending on e.g. time and OS.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>g = tf.random.Generator.from_non_deterministic_state()
print(g.normal(shape=[2, 3]))
</pre></div>
</div>
</div>
<p>There are yet other ways to create generators, such as from explicit states, which are not covered by this guide.</p>
<p>When using <code class="docutils literal notranslate"><span class="pre">tf.random.get_global_generator</span></code> to get the global generator, you need to be careful about device placement. The global generator is created (from a non-deterministic state) at the first time <code class="docutils literal notranslate"><span class="pre">tf.random.get_global_generator</span></code> is called, and placed on the default device at that call. So, for example, if the first site you call <code class="docutils literal notranslate"><span class="pre">tf.random.get_global_generator</span></code> is within a <code class="docutils literal notranslate"><span class="pre">tf.device(&quot;gpu&quot;)</span></code> scope, the global generator will be placed on the GPU, and using the global generator
later on from the CPU will incur a GPU-to-CPU copy.</p>
<p>There is also a function <code class="docutils literal notranslate"><span class="pre">tf.random.set_global_generator</span></code> for replacing the global generator with another generator object. This function should be used with caution though, because the old global generator may have been captured by a <code class="docutils literal notranslate"><span class="pre">tf.function</span></code> (as a weak reference), and replacing it will cause it to be garbage collected, breaking the <code class="docutils literal notranslate"><span class="pre">tf.function</span></code>. A better way to reset the global generator is to use one of the “reset” functions such as <code class="docutils literal notranslate"><span class="pre">Generator.reset_from_seed</span></code>, which won’t
create new generator objects.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>g = tf.random.Generator.from_seed(1)
print(g.normal([]))
print(g.normal([]))
g.reset_from_seed(1)
print(g.normal([]))
</pre></div>
</div>
</div>
<div class="section" id="Creating-independent-random-number-streams">
<h4>Creating independent random-number streams<a class="headerlink" href="#Creating-independent-random-number-streams" title="Enlazar permanentemente con este título">¶</a></h4>
<p>In many applications one needs multiple independent random-number streams, independent in the sense that they won’t overlap and won’t have any statistically detectable correlations. This is achieved by using <code class="docutils literal notranslate"><span class="pre">Generator.split</span></code> to create multiple generators that are guaranteed to be independent of each other (i.e. generating independent streams).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>g = tf.random.Generator.from_seed(1)
print(g.normal([]))
new_gs = g.split(3)
for new_g in new_gs:
  print(new_g.normal([]))
print(g.normal([]))
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">split</span></code> will change the state of the generator on which it is called (<code class="docutils literal notranslate"><span class="pre">g</span></code> in the above example), similar to an RNG method such as <code class="docutils literal notranslate"><span class="pre">normal</span></code>. In addition to being independent of each other, the new generators (<code class="docutils literal notranslate"><span class="pre">new_gs</span></code>) are also guaranteed to be independent of the old one (<code class="docutils literal notranslate"><span class="pre">g</span></code>).</p>
<p>Spawning new generators is also useful when you want to make sure the generator you use is on the same device as other computations, to avoid the overhead of cross-device copy. For example:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>with tf.device(&quot;cpu&quot;):  # change &quot;cpu&quot; to the device you want
  g = tf.random.get_global_generator().split(1)[0]
  print(g.normal([]))  # use of g won&#39;t cause cross-device copy, unlike the global generator
</pre></div>
</div>
</div>
<p>Note: In theory, you can use constructors such as <code class="docutils literal notranslate"><span class="pre">from_seed</span></code> instead of <code class="docutils literal notranslate"><span class="pre">split</span></code> here to obtain a new generator, but by doing so you lose the guarantee that the new generator is independent of the global generator. You will also run the risk that you may accidentally create two generators with the same seed or with seeds that lead to overlapping random-number streams.</p>
<p>You can do splitting recursively, calling <code class="docutils literal notranslate"><span class="pre">split</span></code> on splitted generators. There are no limits (barring integer overflow) on the depth of recursions.</p>
</div>
<div class="section" id="Interaction-with-tf.function">
<h4>Interaction with <code class="docutils literal notranslate"><span class="pre">tf.function</span></code><a class="headerlink" href="#Interaction-with-tf.function" title="Enlazar permanentemente con este título">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">tf.random.Generator</span></code> obeys the same rules as <code class="docutils literal notranslate"><span class="pre">tf.Variable</span></code> when used with <code class="docutils literal notranslate"><span class="pre">tf.function</span></code>. This includes three aspects.</p>
<div class="section" id="Creating-generators-outside-tf.function">
<h5>Creating generators outside <code class="docutils literal notranslate"><span class="pre">tf.function</span></code><a class="headerlink" href="#Creating-generators-outside-tf.function" title="Enlazar permanentemente con este título">¶</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">tf.function</span></code> can use a generator created outside of it.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>g = tf.random.Generator.from_seed(1)
@tf.function
def foo():
  return g.normal([])
print(foo())
</pre></div>
</div>
</div>
<p>The user needs to make sure that the generator object is still alive (not garbage-collected) when the function is called.</p>
</div>
<div class="section" id="Creating-generators-inside-tf.function">
<h5>Creating generators inside <code class="docutils literal notranslate"><span class="pre">tf.function</span></code><a class="headerlink" href="#Creating-generators-inside-tf.function" title="Enlazar permanentemente con este título">¶</a></h5>
<p>Creation of generators inside a <code class="docutils literal notranslate"><span class="pre">tf.function</span></code> can only happend during the first run of the function.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>g = None
@tf.function
def foo():
  global g
  if g is None:
    g = tf.random.Generator.from_seed(1)
  return g.normal([])
print(foo())
print(foo())
</pre></div>
</div>
</div>
</div>
<div class="section" id="Passing-generators-as-arguments-to-tf.function">
<h5>Passing generators as arguments to <code class="docutils literal notranslate"><span class="pre">tf.function</span></code><a class="headerlink" href="#Passing-generators-as-arguments-to-tf.function" title="Enlazar permanentemente con este título">¶</a></h5>
<p>When used as an argument to a <code class="docutils literal notranslate"><span class="pre">tf.function</span></code>, different generator objects with the same state size (state size is determined by the RNG algorithm) won’t cause retracing of the <code class="docutils literal notranslate"><span class="pre">tf.function</span></code>, while those with different state sizes will.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>num_traces = 0
@tf.function
def foo(g):
  global num_traces
  num_traces += 1
  return g.normal([])
foo(tf.random.Generator.from_seed(1))
foo(tf.random.Generator.from_seed(2))
print(num_traces)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Interaction-with-distribution-strategies">
<h4>Interaction with distribution strategies<a class="headerlink" href="#Interaction-with-distribution-strategies" title="Enlazar permanentemente con este título">¶</a></h4>
<p>There are three ways in which <code class="docutils literal notranslate"><span class="pre">Generator</span></code> interacts with distribution strategies.</p>
<div class="section" id="Creating-generators-outside-distribution-strategies">
<h5>Creating generators outside distribution strategies<a class="headerlink" href="#Creating-generators-outside-distribution-strategies" title="Enlazar permanentemente con este título">¶</a></h5>
<p>If a generator is created outside strategy scopes, all replicas’ access to the generator will be serialized, and hence the replicas will get different random numbers.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>g = tf.random.Generator.from_seed(1)
strat = tf.distribute.MirroredStrategy(devices=[&quot;cpu:0&quot;, &quot;cpu:1&quot;])
with strat.scope():
  def f():
    print(g.normal([]))
  results = strat.run(f)
</pre></div>
</div>
</div>
<p>Note that this usage may have performance issues because the generator’s device is different from the replicas.</p>
</div>
<div class="section" id="Creating-generators-inside-distribution-strategies">
<h5>Creating generators inside distribution strategies<a class="headerlink" href="#Creating-generators-inside-distribution-strategies" title="Enlazar permanentemente con este título">¶</a></h5>
<p>Creating generators inside strategy scopes is disallowed, because there is ambiguity on how to replicate a generator (e.g. should it be copied so that each replica gets the same random numbers, or ‘split’ so that each replica gets different random numbers).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>strat = tf.distribute.MirroredStrategy(devices=[&quot;cpu:0&quot;, &quot;cpu:1&quot;])
with strat.scope():
  try:
    tf.random.Generator.from_seed(1)
  except ValueError as e:
    print(&quot;ValueError:&quot;, e)
</pre></div>
</div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">Strategy.run</span></code> will run its argument function in a strategy scope implicitly:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>strat = tf.distribute.MirroredStrategy(devices=[&quot;cpu:0&quot;, &quot;cpu:1&quot;])
def f():
  tf.random.Generator.from_seed(1)
try:
  strat.run(f)
except ValueError as e:
  print(&quot;ValueError:&quot;, e)
</pre></div>
</div>
</div>
</div>
<div class="section" id="Passing-generators-as-arguments-to-Strategy.run">
<h5>Passing generators as arguments to <code class="docutils literal notranslate"><span class="pre">Strategy.run</span></code><a class="headerlink" href="#Passing-generators-as-arguments-to-Strategy.run" title="Enlazar permanentemente con este título">¶</a></h5>
<p>If you want each replica to use its own generator, you need to make <code class="docutils literal notranslate"><span class="pre">n</span></code> generators (either by copying or splitting), where <code class="docutils literal notranslate"><span class="pre">n</span></code> is the number of replicas, and then pass them as arguments to <code class="docutils literal notranslate"><span class="pre">Strategy.run</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>strat = tf.distribute.MirroredStrategy(devices=[&quot;cpu:0&quot;, &quot;cpu:1&quot;])
gs = tf.random.get_global_generator().split(2)
# to_args is a workaround for the absence of APIs to create arguments for
# run. It will be replaced when such APIs are available.
def to_args(gs):
  with strat.scope():
    def f():
      return [gs[tf.distribute.get_replica_context().replica_id_in_sync_group]]
    return strat.run(f)
args = to_args(gs)
def f(g):
  print(g.normal([]))
results = strat.run(f, args=args)
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="Stateless-RNGs">
<h3>Stateless RNGs<a class="headerlink" href="#Stateless-RNGs" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Usage of stateless RNGs is simple. Since they are just pure functions, there is no state or side effect involved.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>print(tf.random.stateless_normal(shape=[2, 3], seed=[1, 2]))
print(tf.random.stateless_normal(shape=[2, 3], seed=[1, 2]))
</pre></div>
</div>
</div>
<p>Every stateless RNG requires a <code class="docutils literal notranslate"><span class="pre">seed</span></code> argument, which needs to be an integer Tensor of shape <code class="docutils literal notranslate"><span class="pre">[2]</span></code>. The results of the op are fully determined by this seed.</p>
</div>
<div class="section" id="Algorithms">
<h3>Algorithms<a class="headerlink" href="#Algorithms" title="Enlazar permanentemente con este título">¶</a></h3>
<div class="section" id="General">
<h4>General<a class="headerlink" href="#General" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Both the <code class="docutils literal notranslate"><span class="pre">tf.random.Generator</span></code> class and the <code class="docutils literal notranslate"><span class="pre">stateless</span></code> functions support the Philox algorithm (written as <code class="docutils literal notranslate"><span class="pre">&quot;philox&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">tf.random.Algorithm.PHILOX</span></code>) on all devices.</p>
<p>Different devices will generate the same integer numbers, if using the same algorithm and starting from the same state. They will also generate “almost the same” float-point numbers, though there may be small numerical discrepancies caused by the different ways the devices carry out the float-point computation (e.g. reduction order).</p>
</div>
<div class="section" id="XLA-devices">
<h4>XLA devices<a class="headerlink" href="#XLA-devices" title="Enlazar permanentemente con este título">¶</a></h4>
<p>On XLA-driven devices (such as TPU, and also CPU/GPU when XLA is enabled) the ThreeFry algorithm (written as <code class="docutils literal notranslate"><span class="pre">&quot;threefry&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">tf.random.Algorithm.THREEFRY</span></code>) is also supported. This algorithm is fast on TPU but slow on CPU/GPU compared to Philox.</p>
<p>See paper <a class="reference external" href="https://www.thesalmons.org/john/random123/papers/random123sc11.pdf">‘Parallel Random Numbers: As Easy as 1, 2, 3’</a> for more details about these algorithms.</p>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Derechos de autor 2019, Juan D. Velasquez.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-XXXXXXX-1', 'auto');
    
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>