

<!DOCTYPE html>
<html class="writer-html5" lang="es" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Copyright 2018 The TensorFlow Authors. &mdash; documentación de --- Cursos --- - </title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../../_static/clipboard.min.js"></script>
        <script type="text/javascript" src="../../../_static/copybutton.js"></script>
        <script type="text/javascript" src="../../../_static/translations.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Índice" href="../../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> --- Cursos ---
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Configuración</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../setup.html">Instalación de Vagrant y Docker</a></li>
</ul>
<p class="caption"><span class="caption-text">Cursos</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../analitica-de-grandes-datos/index.html">Analítica de grandes datos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../analitica-financiera/index.html">Analítica Financiera</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../analitica-predictiva/index.html">Analítica Predictiva</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ciencia-de-los-datos/index.html">Ciencia de los Datos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fundamentos-de-analitica/index.html">Fundamentos de Analítica</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../productos-de-datos/index.html">Productos de Datos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../redes-neuronales-con-tensorflow/index.html">Redes Neuronales Artificiales</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">--- Cursos ---</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Copyright 2018 The TensorFlow Authors.</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../_sources/notebooks/tensorflow/guide/checkpoint.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Copyright-2018-The-TensorFlow-Authors.">
<h1>Copyright 2018 The TensorFlow Authors.<a class="headerlink" href="#Copyright-2018-The-TensorFlow-Authors." title="Enlazar permanentemente con este título">¶</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>#@title Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
</pre></div>
</div>
</div>
<div class="section" id="Training-checkpoints">
<h2>Training checkpoints<a class="headerlink" href="#Training-checkpoints" title="Enlazar permanentemente con este título">¶</a></h2>
<table class="tfo-notebook-buttons" align="left"><td><p><a href="#id1"><span class="problematic" id="id2">|</span></a>832a93beb4b2484e859657210c6dcd22|View on TensorFlow.org</p>
</td><td><p><a href="#id3"><span class="problematic" id="id4">|</span></a>1bc03511fb8b4762aac7bda6f940543b|Run in Google Colab</p>
</td><td><p><a href="#id5"><span class="problematic" id="id6">|</span></a>43332dce35aa41e98f80aae8507afde0|View source on GitHub</p>
</td><td><p><a href="#id7"><span class="problematic" id="id8">|</span></a>6f149b11ceed48b099b8a216d501034a|Download notebook</p>
</td></table><p>The phrase “Saving a TensorFlow model” typically means one of two things:</p>
<ol class="arabic simple">
<li><p>Checkpoints, OR</p></li>
<li><p>SavedModel.</p></li>
</ol>
<p>Checkpoints capture the exact value of all parameters (<code class="docutils literal notranslate"><span class="pre">tf.Variable</span></code> objects) used by a model. Checkpoints do not contain any description of the computation defined by the model and thus are typically only useful when source code that will use the saved parameter values is available.</p>
<p>The SavedModel format on the other hand includes a serialized description of the computation defined by the model in addition to the parameter values (checkpoint). Models in this format are independent of the source code that created the model. They are thus suitable for deployment via TensorFlow Serving, TensorFlow Lite, TensorFlow.js, or programs in other programming languages (the C, C++, Java, Go, Rust, C# etc. TensorFlow APIs).</p>
<p>This guide covers APIs for writing and reading checkpoints.</p>
<div class="section" id="Setup">
<h3>Setup<a class="headerlink" href="#Setup" title="Enlazar permanentemente con este título">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>import tensorflow as tf
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>class Net(tf.keras.Model):
  &quot;&quot;&quot;A simple linear model.&quot;&quot;&quot;

  def __init__(self):
    super(Net, self).__init__()
    self.l1 = tf.keras.layers.Dense(5)

  def call(self, x):
    return self.l1(x)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>net = Net()
</pre></div>
</div>
</div>
</div>
<div class="section" id="Saving-from-tf.keras-training-APIs">
<h3>Saving from <code class="docutils literal notranslate"><span class="pre">tf.keras</span></code> training APIs<a class="headerlink" href="#Saving-from-tf.keras-training-APIs" title="Enlazar permanentemente con este título">¶</a></h3>
<p>See the <code class="docutils literal notranslate"><span class="pre">`tf.keras</span></code> guide on saving and restoring &lt;./keras/overview.ipynb#save_and_restore&gt;`__.</p>
<p><code class="docutils literal notranslate"><span class="pre">tf.keras.Model.save_weights</span></code> saves a TensorFlow checkpoint.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>net.save_weights(&#39;easy_checkpoint&#39;)
</pre></div>
</div>
</div>
</div>
<div class="section" id="Writing-checkpoints">
<h3>Writing checkpoints<a class="headerlink" href="#Writing-checkpoints" title="Enlazar permanentemente con este título">¶</a></h3>
<p>The persistent state of a TensorFlow model is stored in <code class="docutils literal notranslate"><span class="pre">tf.Variable</span></code> objects. These can be constructed directly, but are often created through high-level APIs like <code class="docutils literal notranslate"><span class="pre">tf.keras.layers</span></code> or <code class="docutils literal notranslate"><span class="pre">tf.keras.Model</span></code>.</p>
<p>The easiest way to manage variables is by attaching them to Python objects, then referencing those objects.</p>
<p>Subclasses of <code class="docutils literal notranslate"><span class="pre">tf.train.Checkpoint</span></code>, <code class="docutils literal notranslate"><span class="pre">tf.keras.layers.Layer</span></code>, and <code class="docutils literal notranslate"><span class="pre">tf.keras.Model</span></code> automatically track variables assigned to their attributes. The following example constructs a simple linear model, then writes checkpoints which contain values for all of the model’s variables.</p>
<p>You can easily save a model-checkpoint with <code class="docutils literal notranslate"><span class="pre">Model.save_weights</span></code>.</p>
<div class="section" id="Manual-checkpointing">
<h4>Manual checkpointing<a class="headerlink" href="#Manual-checkpointing" title="Enlazar permanentemente con este título">¶</a></h4>
<div class="section" id="id9">
<h5>Setup<a class="headerlink" href="#id9" title="Enlazar permanentemente con este título">¶</a></h5>
<p>To help demonstrate all the features of <code class="docutils literal notranslate"><span class="pre">tf.train.Checkpoint</span></code>, define a toy dataset and optimization step:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>def toy_dataset():
  inputs = tf.range(10.)[:, None]
  labels = inputs * 5. + tf.range(5.)[None, :]
  return tf.data.Dataset.from_tensor_slices(
    dict(x=inputs, y=labels)).repeat().batch(2)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>def train_step(net, example, optimizer):
  &quot;&quot;&quot;Trains `net` on `example` using `optimizer`.&quot;&quot;&quot;
  with tf.GradientTape() as tape:
    output = net(example[&#39;x&#39;])
    loss = tf.reduce_mean(tf.abs(output - example[&#39;y&#39;]))
  variables = net.trainable_variables
  gradients = tape.gradient(loss, variables)
  optimizer.apply_gradients(zip(gradients, variables))
  return loss
</pre></div>
</div>
</div>
</div>
<div class="section" id="Create-the-checkpoint-objects">
<h5>Create the checkpoint objects<a class="headerlink" href="#Create-the-checkpoint-objects" title="Enlazar permanentemente con este título">¶</a></h5>
<p>Use a <code class="docutils literal notranslate"><span class="pre">tf.train.Checkpoint</span></code> object to manually create a checkpoint, where the objects you want to checkpoint are set as attributes on the object.</p>
<p>A <code class="docutils literal notranslate"><span class="pre">tf.train.CheckpointManager</span></code> can also be helpful for managing multiple checkpoints.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>opt = tf.keras.optimizers.Adam(0.1)
dataset = toy_dataset()
iterator = iter(dataset)
ckpt = tf.train.Checkpoint(step=tf.Variable(1), optimizer=opt, net=net, iterator=iterator)
manager = tf.train.CheckpointManager(ckpt, &#39;./tf_ckpts&#39;, max_to_keep=3)
</pre></div>
</div>
</div>
</div>
<div class="section" id="Train-and-checkpoint-the-model">
<h5>Train and checkpoint the model<a class="headerlink" href="#Train-and-checkpoint-the-model" title="Enlazar permanentemente con este título">¶</a></h5>
<p>The following training loop creates an instance of the model and of an optimizer, then gathers them into a <code class="docutils literal notranslate"><span class="pre">tf.train.Checkpoint</span></code> object. It calls the training step in a loop on each batch of data, and periodically writes checkpoints to disk.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>def train_and_checkpoint(net, manager):
  ckpt.restore(manager.latest_checkpoint)
  if manager.latest_checkpoint:
    print(&quot;Restored from {}&quot;.format(manager.latest_checkpoint))
  else:
    print(&quot;Initializing from scratch.&quot;)

  for _ in range(50):
    example = next(iterator)
    loss = train_step(net, example, opt)
    ckpt.step.assign_add(1)
    if int(ckpt.step) % 10 == 0:
      save_path = manager.save()
      print(&quot;Saved checkpoint for step {}: {}&quot;.format(int(ckpt.step), save_path))
      print(&quot;loss {:1.2f}&quot;.format(loss.numpy()))
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>train_and_checkpoint(net, manager)
</pre></div>
</div>
</div>
</div>
<div class="section" id="Restore-and-continue-training">
<h5>Restore and continue training<a class="headerlink" href="#Restore-and-continue-training" title="Enlazar permanentemente con este título">¶</a></h5>
<p>After the first training cycle you can pass a new model and manager, but pick up training exactly where you left off:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>opt = tf.keras.optimizers.Adam(0.1)
net = Net()
dataset = toy_dataset()
iterator = iter(dataset)
ckpt = tf.train.Checkpoint(step=tf.Variable(1), optimizer=opt, net=net, iterator=iterator)
manager = tf.train.CheckpointManager(ckpt, &#39;./tf_ckpts&#39;, max_to_keep=3)

train_and_checkpoint(net, manager)
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">tf.train.CheckpointManager</span></code> object deletes old checkpoints. Above it’s configured to keep only the three most recent checkpoints.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>print(manager.checkpoints)  # List the three remaining checkpoints
</pre></div>
</div>
</div>
<p>These paths, e.g. <code class="docutils literal notranslate"><span class="pre">'./tf_ckpts/ckpt-10'</span></code>, are not files on disk. Instead they are prefixes for an <code class="docutils literal notranslate"><span class="pre">index</span></code> file and one or more data files which contain the variable values. These prefixes are grouped together in a single <code class="docutils literal notranslate"><span class="pre">checkpoint</span></code> file (<code class="docutils literal notranslate"><span class="pre">'./tf_ckpts/checkpoint'</span></code>) where the <code class="docutils literal notranslate"><span class="pre">CheckpointManager</span></code> saves its state.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>!ls ./tf_ckpts
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="Loading-mechanics">
<h3>Loading mechanics<a class="headerlink" href="#Loading-mechanics" title="Enlazar permanentemente con este título">¶</a></h3>
<p>TensorFlow matches variables to checkpointed values by traversing a directed graph with named edges, starting from the object being loaded. Edge names typically come from attribute names in objects, for example the <code class="docutils literal notranslate"><span class="pre">&quot;l1&quot;</span></code> in <code class="docutils literal notranslate"><span class="pre">self.l1</span> <span class="pre">=</span> <span class="pre">tf.keras.layers.Dense(5)</span></code>. <code class="docutils literal notranslate"><span class="pre">tf.train.Checkpoint</span></code> uses its keyword argument names, as in the <code class="docutils literal notranslate"><span class="pre">&quot;step&quot;</span></code> in <code class="docutils literal notranslate"><span class="pre">tf.train.Checkpoint(step=...)</span></code>.</p>
<p>The dependency graph from the example above looks like this:</p>
<p><img alt="Visualization of the dependency graph for the example training loop" src="https://tensorflow.org/images/guide/whole_checkpoint.svg" /></p>
<p>The optimizer is in red, regular variables are in blue, and the optimizer slot variables are in orange. The other nodes—for example, representing the <code class="docutils literal notranslate"><span class="pre">tf.train.Checkpoint</span></code>—are in black.</p>
<p>Slot variables are part of the optimizer’s state, but are created for a specific variable. For example the <code class="docutils literal notranslate"><span class="pre">'m'</span></code> edges above correspond to momentum, which the Adam optimizer tracks for each variable. Slot variables are only saved in a checkpoint if the variable and the optimizer would both be saved, thus the dashed edges.</p>
<p>Calling <code class="docutils literal notranslate"><span class="pre">restore</span></code> on a <code class="docutils literal notranslate"><span class="pre">tf.train.Checkpoint</span></code> object queues the requested restorations, restoring variable values as soon as there’s a matching path from the <code class="docutils literal notranslate"><span class="pre">Checkpoint</span></code> object. For example, you can load just the bias from the model you defined above by reconstructing one path to it through the network and the layer.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>to_restore = tf.Variable(tf.zeros([5]))
print(to_restore.numpy())  # All zeros
fake_layer = tf.train.Checkpoint(bias=to_restore)
fake_net = tf.train.Checkpoint(l1=fake_layer)
new_root = tf.train.Checkpoint(net=fake_net)
status = new_root.restore(tf.train.latest_checkpoint(&#39;./tf_ckpts/&#39;))
print(to_restore.numpy())  # This gets the restored value.
</pre></div>
</div>
</div>
<p>The dependency graph for these new objects is a much smaller subgraph of the larger checkpoint you wrote above. It includes only the bias and a save counter that <code class="docutils literal notranslate"><span class="pre">tf.train.Checkpoint</span></code> uses to number checkpoints.</p>
<p><img alt="Visualization of a subgraph for the bias variable" src="https://tensorflow.org/images/guide/partial_checkpoint.svg" /></p>
<p><code class="docutils literal notranslate"><span class="pre">restore</span></code> returns a status object, which has optional assertions. All of the objects created in the new <code class="docutils literal notranslate"><span class="pre">Checkpoint</span></code> have been restored, so <code class="docutils literal notranslate"><span class="pre">status.assert_existing_objects_matched</span></code> passes.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>status.assert_existing_objects_matched()
</pre></div>
</div>
</div>
<p>There are many objects in the checkpoint which haven’t matched, including the layer’s kernel and the optimizer’s variables. <code class="docutils literal notranslate"><span class="pre">status.assert_consumed</span></code> only passes if the checkpoint and the program match exactly, and would throw an exception here.</p>
<div class="section" id="Delayed-restorations">
<h4>Delayed restorations<a class="headerlink" href="#Delayed-restorations" title="Enlazar permanentemente con este título">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">Layer</span></code> objects in TensorFlow may delay the creation of variables to their first call, when input shapes are available. For example the shape of a <code class="docutils literal notranslate"><span class="pre">Dense</span></code> layer’s kernel depends on both the layer’s input and output shapes, and so the output shape required as a constructor argument is not enough information to create the variable on its own. Since calling a <code class="docutils literal notranslate"><span class="pre">Layer</span></code> also reads the variable’s value, a restore must happen between the variable’s creation and its first use.</p>
<p>To support this idiom, <code class="docutils literal notranslate"><span class="pre">tf.train.Checkpoint</span></code> queues restores which don’t yet have a matching variable.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>delayed_restore = tf.Variable(tf.zeros([1, 5]))
print(delayed_restore.numpy())  # Not restored; still zeros
fake_layer.kernel = delayed_restore
print(delayed_restore.numpy())  # Restored
</pre></div>
</div>
</div>
</div>
<div class="section" id="Manually-inspecting-checkpoints">
<h4>Manually inspecting checkpoints<a class="headerlink" href="#Manually-inspecting-checkpoints" title="Enlazar permanentemente con este título">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">tf.train.load_checkpoint</span></code> returns a <code class="docutils literal notranslate"><span class="pre">CheckpointReader</span></code> that gives lower level access to the checkpoint contents. It contains mappings from each vartiable’s key, to the shape and dtype for each variable in the checkpoint. A variable’s key is its object path, like in the graphs displayed above.</p>
<p>Note: There is no higher level structure to the checkpoint. It only know’s the paths and values for the variables, and has no concept of <code class="docutils literal notranslate"><span class="pre">models</span></code>, <code class="docutils literal notranslate"><span class="pre">layers</span></code> or how they are connected.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>reader = tf.train.load_checkpoint(&#39;./tf_ckpts/&#39;)
shape_from_key = reader.get_variable_to_shape_map()
dtype_from_key = reader.get_variable_to_dtype_map()

sorted(shape_from_key.keys())
</pre></div>
</div>
</div>
<p>So if you’re interested in the value of <code class="docutils literal notranslate"><span class="pre">net.l1.kernel</span></code> you can get the value with the following code:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>key = &#39;net/l1/kernel/.ATTRIBUTES/VARIABLE_VALUE&#39;

print(&quot;Shape:&quot;, shape_from_key[key])
print(&quot;Dtype:&quot;, dtype_from_key[key].name)
</pre></div>
</div>
</div>
<p>It also provides a <code class="docutils literal notranslate"><span class="pre">get_tensor</span></code> method allowing you to inspect the value of a variable:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>reader.get_tensor(key)
</pre></div>
</div>
</div>
</div>
<div class="section" id="List-and-dictionary-tracking">
<h4>List and dictionary tracking<a class="headerlink" href="#List-and-dictionary-tracking" title="Enlazar permanentemente con este título">¶</a></h4>
<p>As with direct attribute assignments like <code class="docutils literal notranslate"><span class="pre">self.l1</span> <span class="pre">=</span> <span class="pre">tf.keras.layers.Dense(5)</span></code>, assigning lists and dictionaries to attributes will track their contents.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>save = tf.train.Checkpoint()
save.listed = [tf.Variable(1.)]
save.listed.append(tf.Variable(2.))
save.mapped = {&#39;one&#39;: save.listed[0]}
save.mapped[&#39;two&#39;] = save.listed[1]
save_path = save.save(&#39;./tf_list_example&#39;)

restore = tf.train.Checkpoint()
v2 = tf.Variable(0.)
assert 0. == v2.numpy()  # Not restored yet
restore.mapped = {&#39;two&#39;: v2}
restore.restore(save_path)
assert 2. == v2.numpy()
</pre></div>
</div>
</div>
<p>You may notice wrapper objects for lists and dictionaries. These wrappers are checkpointable versions of the underlying data-structures. Just like the attribute based loading, these wrappers restore a variable’s value as soon as it’s added to the container.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>restore.listed = []
print(restore.listed)  # ListWrapper([])
v1 = tf.Variable(0.)
restore.listed.append(v1)  # Restores v1, from restore() in the previous cell
assert 1. == v1.numpy()
</pre></div>
</div>
</div>
<p>The same tracking is automatically applied to subclasses of <code class="docutils literal notranslate"><span class="pre">tf.keras.Model</span></code>, and may be used for example to track lists of layers.</p>
</div>
</div>
<div class="section" id="Summary">
<h3>Summary<a class="headerlink" href="#Summary" title="Enlazar permanentemente con este título">¶</a></h3>
<p>TensorFlow objects provide an easy automatic mechanism for saving and restoring the values of variables they use.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Derechos de autor 2019, Juan D. Velasquez.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-XXXXXXX-1', 'auto');
    
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>